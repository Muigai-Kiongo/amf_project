{% extends "base.html" %}
{% load humanize %}
{% block title %}Goal Details{% endblock %}
{% block content %}
<div class="flex justify-center mt-8">
    <div class="w-full max-w-2xl">
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="bg-green-600 text-white rounded-t-lg px-6 py-4 flex items-center gap-3">
                <i class="fa-solid fa-bullseye text-2xl"></i>
                <h2 class="font-bold text-2xl">{{ goal.name }}</h2>
            </div>
            <div class="px-6 py-5">
                <div class="mb-4 flex flex-col gap-2">
                    <p>
                        <span class="font-semibold text-gray-700"><i class="fa-solid fa-building-columns mr-2"></i>Account:</span>
                        <span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded text-sm">{{ goal.account.name }}</span>
                    </p>
                    <p>
                        <span class="font-semibold text-gray-700"><i class="fa-solid fa-flag-checkered mr-2"></i>Target amount:</span>
                        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm font-mono">{{ goal.target_amount|floatformat:2|intcomma }} KES</span>
                    </p>
                    <p>
                        <span class="font-semibold text-gray-700"><i class="fa-solid fa-piggy-bank mr-2"></i>Current amount:</span>
                        <span class="bg-teal-100 text-teal-700 px-3 py-1 rounded text-sm font-mono">{{ goal.current_amount|floatformat:2|intcomma }} KES</span>
                    </p>
                    <p>
                        <span class="font-semibold text-gray-700"><i class="fa-solid fa-calendar-day mr-2"></i>Deadline:</span>
                        <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded text-sm">{{ goal.deadline }}</span>
                    </p>
                </div>
                <div class="mb-6">
                    <span class="font-semibold text-gray-700"><i class="fa-solid fa-chart-line mr-2"></i>Progress:</span>
                    <div class="w-full bg-gray-200 rounded-full h-7 mt-2 flex items-center">
                        <div
                            class="h-7 rounded-full flex items-center justify-center font-semibold text-base
                            {% if goal.progress_percent == 100 %}bg-green-500 text-white
                            {% elif goal.progress_percent > 60 %}bg-blue-400 text-white
                            {% elif goal.progress_percent > 30 %}bg-yellow-400 text-gray-900
                            {% else %}bg-red-500 text-white{% endif %}"
                            style="width: {{ goal.progress_percent|floatformat:0 }}%;"
                            aria-valuenow="{{ goal.progress_percent|floatformat:0 }}"
                            aria-valuemin="0"
                            aria-valuemax="100"
                        >
                            {{ goal.progress_percent|floatformat:0 }}%
                        </div>
                    </div>
                </div>
                <!-- Quick Actions for Deposit/Withdraw -->
                <div class="flex gap-2 mt-4">
                    <a href="{% url 'goal_deposit' goal.pk %}" class="inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500 transition">
                        <i class="fa-solid fa-arrow-down mr-1"></i> Deposit
                    </a>
                    <a href="{% url 'goal_withdraw' goal.pk %}" class="inline-flex items-center bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500 transition">
                        <i class="fa-solid fa-arrow-up mr-1"></i> Withdraw
                    </a>
                </div>
                <!-- Show recent transactions for this goal -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-2 text-gray-700">Recent Goal Transactions</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-gray-50 rounded">
                            <thead>
                                <tr>
                                    <th class="py-2 px-3 text-left text-xs font-bold text-gray-600">Date</th>
                                    <th class="py-2 px-3 text-left text-xs font-bold text-gray-600">Type</th>
                                    <th class="py-2 px-3 text-left text-xs font-bold text-gray-600">Amount</th>
                                    <th class="py-2 px-3 text-left text-xs font-bold text-gray-600">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transaction in goal.transaction_set.all|slice:":5" %}
                                <tr>
                                    <td class="py-2 px-3 text-xs">{{ transaction.date|date:"Y-m-d" }}</td>
                                    <td class="py-2 px-3 text-xs">
                                        <span class="px-2 py-1 rounded text-xs {% if transaction.type == 'income' %}bg-green-100 text-green-700{% elif transaction.type == 'expense' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %}">
                                            {{ transaction.get_type_display }}
                                        </span>
                                    </td>
                                    <td class="py-2 px-3 text-xs font-mono">{{ transaction.amount|floatformat:2|intcomma }} KES</td>
                                    <td class="py-2 px-3 text-xs">{{ transaction.description|default:"-" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-gray-400 py-3 text-xs">No transactions for this goal.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="bg-gray-100 px-6 py-4 rounded-b-lg flex justify-end gap-2">
                <a href="{% url 'goal-update' goal.pk %}" class="inline-flex items-center bg-yellow-400 text-gray-900 px-4 py-2 rounded hover:bg-yellow-300 transition">
                    <i class="fa-solid fa-pen mr-1"></i> Edit
                </a>
                <a href="{% url 'goal-delete' goal.pk %}" class="inline-flex items-center bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500 transition">
                    <i class="fa-solid fa-trash mr-1"></i> Delete
                </a>
                <a href="{% url 'goal-list' %}" class="inline-flex items-center bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition">
                    <i class="fa-solid fa-arrow-left mr-1"></i> Back to List
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}